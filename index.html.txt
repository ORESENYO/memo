<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>テキストダウンロードツール</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: system-ui, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; margin: 0; padding: 20px; }
  h1 { margin: 0 0 12px; font-size: 1.25rem; }
  .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
  .controls input[type="text"] { padding: 6px 8px; font-size: 1rem; min-width: 240px; }
  .controls label { display: inline-flex; align-items: center; gap: 6px; }
  button { padding: 8px 14px; font-size: 1rem; cursor: pointer; }
  details { margin-top: 14px; }
  textarea#src { width: 100%; min-height: 220px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
  .tip { color: #666; font-size: .9rem; margin-top: 8px; }
</style>
</head>
<body>

<h1>「以下の文字列」をテキストファイルとしてダウンロード</h1>

<div class="controls">
  <label>ファイル名：
    <input id="filename" type="text" value="realtime_viewer.txt" />
  </label>
  <label title="Windows のメモ帳で文字化けしにくくなります">
    <input id="useBOM" type="checkbox" checked> BOMを付与（UTF-8）
  </label>
  <button id="downloadBtn">この内容をダウンロード</button>
</div>
<p class="tip">※下のテキストはそのまま保存されます。必要なら編集してから保存してください。</p>

<details open>
  <summary>保存対象のテキスト（展開して編集可）</summary>
  <textarea id="src"><!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>リアルタイム検索ビューア</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }
h2, h3 { margin: 10px 0; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }
#results { margin-top: 15px; }
.result-item { cursor: pointer; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
.result-item:hover { background-color: #f0f0f0; }

#modalOverlay {
display: none;
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: rgba(0,0,0,0.5); z-index: 999;
justify-content: center; align-items: center;
}
#modalContent {
background: white; padding: 20px; border-radius: 8px;
max-width: 90%; max-height: 80%; overflow-y: auto; 
box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>リアルタイム検索ビューア</h2>

<label>カテゴリー：</label>
<select id="categorySelect">
<option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
<option value="AND">AND検索</option>
<option value="OR">OR検索</option>
</select>

<h3>検索結果</h3>
<div id="results"></div>

<div id="modalOverlay">
<div id="modalContent">
<h3 id="modalTitle"></h3>
<p id="modalBody"></p>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

const excelData = [{category: "11111",category2: "22222",subject: "33333",body: `
本文行1
本文行2
本文行3
本文行4
本文行5

`},{category: "44444",category2: "55555",subject: "66666",body: `
本文A1
本文A2
本文A3
本文A4
本文A5

`},{category: "77777",category2: "88888",subject: "99999",body: `
本文A11
本文A12
本文A13
本文A14
本文A15

`}];

const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

function showModal(title, body) {
modalTitle.textContent = title;
modalBody.textContent = body;
modalOverlay.style.display = "flex";
}

function closeModal() {
modalOverlay.style.display = "none";
}

modalOverlay.addEventListener("click", function(e) {
if(e.target === modalOverlay) closeModal();
});

function performSearch() {
const cat = document.getElementById("categorySelect").value.trim();
const keyword = document.getElementById("keyword").value.trim();
const mode = document.getElementById("mode").value;
const resultsDiv = document.getElementById("results");
resultsDiv.innerHTML = "";

let keywords = keyword ? keyword.split(/\s+/) : [];

const filtered = excelData.filter(item => {
if (cat && item.category.trim() !== cat) return false;
if (keywords.length === 0) return true;
const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
else return keywords.some(k => text.includes(k.toLowerCase()));
});

if (filtered.length === 0) {
resultsDiv.textContent = "該当なし";
return;
}

filtered.forEach(item => {
const div = document.createElement("div");
div.className = "result-item";
div.textContent = `カテゴリー: ${item.category} | カテゴリー2: ${item.category2} | 件名: ${item.subject}`;
div.addEventListener("click", () => {
showModal(item.subject, item.body);
});
resultsDiv.appendChild(div);
});
}

const categories = new Set(excelData.map(item => item.category));
const select = document.getElementById("categorySelect");
categories.forEach(c => {
const opt = document.createElement("option");
opt.value = c;
opt.textContent = c;
select.appendChild(opt);
});

document.getElementById("keyword").addEventListener("input", performSearch);
document.getElementById("categorySelect").addEventListener("change", performSearch);
document.getElementById("mode").addEventListener("change", performSearch);

performSearch();
});
</script>

</body>
</html></textarea>
</details>

<script>
  // クリックでダウンロード
  document.getElementById('downloadBtn').addEventListener('click', () => {
    const filename = (document.getElementById('filename').value || 'download.txt').trim();
    const withBOM = document.getElementById('useBOM').checked;
    let text = document.getElementById('src').value;

    // 必要に応じてBOMを付与（Windowsメモ帳の文字化け回避）
    const blobParts = withBOM ? ['\uFEFF', text] : [text];
    const blob = new Blob(blobParts, { type: 'text/plain;charset=utf-8' });

    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 0);
  });
</script>

</body>
</html>