<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }
h2, h3,h4 { margin: 10px 0; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }

table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: #f8f8f8; }
tr:hover { background-color: #f0f0f0; cursor: pointer; }

#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>試作品</h2>

<label>カテゴリー：</label>
<select id="categorySelect">
<option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
<option value="AND">AND検索</option>
<option value="OR">OR検索</option>
</select>

<h3>検索結果</h3>
<table id="resultsTable">
  <thead>
    <tr>
      <th>カテゴリー</th>
      <th>詳細</th>
      <th>件名</th>
    </tr>
  </thead>
  <tbody id="results"></tbody>
</table>

<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
  </div>
</div>

<h4>＃更新履歴</h4>
<table id="historyTable">
  <thead>
    <tr>
      <th>Ver</th>
      <th>更新内容</th>
      <th>更新者</th>
      <th>承認者</th>
      <th>更新日</th>
    </tr>
  </thead>
  <tbody id="history"></tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function() {

const excelData = [
  {
    category: "メモ",
    category2: "URL／アカウント",
    subject: "参考サイト",
    body: `以下のリンクをご参照ください。\n<a href="https://example.com" target="_blank">外部サイト</a>`
  },
  {
    category: "世帯(個人)",
    category2: "住所管理",
    subject: "世帯調査",
    body: `世帯に関する調査内容を記載。\n<a href="https://google.com" target="_blank">Google</a>`
  },
  {
    category: "事業",
    category2: "取引先情報",
    subject: "A社との契約",
    body: `契約の詳細内容はこちら。\n<a href="https://yahoo.co.jp" target="_blank">Yahoo</a>`
  }
];

const historyData = [
  { ver: "1.0", content: "新規作成", updater: "菅原", approver: "", date: "2025/08/29" },
  { ver: "1.1", content: "UI改善", updater: "菅原", approver: "管理者", date: "2025/09/01" }
];

const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

function showModal(title, body) {
  modalTitle.textContent = title;
  modalBody.innerHTML = body; // ← HTMLを反映（リンク有効）
  modalOverlay.style.display = "flex";
}

function closeModal() {
  modalOverlay.style.display = "none";
}
modalOverlay.addEventListener("click", function(e) {
  if(e.target === modalOverlay) closeModal();
});

function performSearch() {
  const cat = document.getElementById("categorySelect").value.trim();
  const keyword = document.getElementById("keyword").value.trim();
  const mode = document.getElementById("mode").value;
  const resultsTbody = document.getElementById("results");
  resultsTbody.innerHTML = "";

  let keywords = keyword ? keyword.split(/\s+/) : [];

  const filtered = excelData.filter(item => {
    if (cat && item.category.trim() !== cat) return false;
    if (keywords.length === 0) return true;
    const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
    if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
    else return keywords.some(k => text.includes(k.toLowerCase()));
  });

  if (filtered.length === 0) {
    const row = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 3;
    td.textContent = "該当なし";
    row.appendChild(td);
    resultsTbody.appendChild(row);
    return;
  }

  filtered.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.category}</td>
      <td>${item.category2}</td>
      <td>${item.subject}</td>
    `;
    row.addEventListener("click", () => {
      showModal(item.subject, item.body);
    });
    resultsTbody.appendChild(row);
  });
}

// カテゴリセレクト初期化
const categories = new Set(excelData.map(item => item.category));
const select = document.getElementById("categorySelect");
categories.forEach(c => {
  if (c.trim() !== "") {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  }
});

// 更新履歴テーブル反映
const historyTbody = document.getElementById("history");
historyData.forEach(h => {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${h.ver}</td>
    <td>${h.content}</td>
    <td>${h.updater}</td>
    <td>${h.approver}</td>
    <td>${h.date}</td>
  `;
  historyTbody.appendChild(row);
});

document.getElementById("keyword").addEventListener("input", performSearch);
document.getElementById("categorySelect").addEventListener("change", performSearch);
document.getElementById("mode").addEventListener("change", performSearch);

performSearch();
});
</script>

</body>
</html>