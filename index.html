<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }
h2, h3, h4 { margin: 10px 0; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }

table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
tr:hover { background-color: #f9f9f9; cursor: pointer; }

#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalBody { white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>試作品</h2>

<label>カテゴリー：</label>
<select id="categorySelect">
<option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
<option value="AND">AND検索</option>
<option value="OR">OR検索</option>
</select>

<h3>検索結果</h3>
<table id="resultsTable">
  <thead>
    <tr><th>カテゴリー</th><th>詳細</th></tr>
  </thead>
  <tbody id="results"></tbody>
</table>

<!-- モーダル -->
<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
  </div>
</div>

<h4>更新履歴</h4>
<table>
  <thead>
    <tr><th>Ver</th><th>更新内容</th><th>更新者</th><th>承認者</th><th>更新日</th></tr>
  </thead>
  <tbody>
    <tr>
      <td>1.0</td><td>新規作成</td><td>菅原</td><td></td><td>2025/08/29</td>
    </tr>
    <tr>
      <td>1.1</td><td>リンク対応</td><td>菅原</td><td>田中</td><td>2025/09/01</td>
    </tr>
  </tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const excelData = [
    {
      category: "メモ",
      category2: "URL／アカウント",
      subject: "参考リンク",
      body: `こちらのサイトをご確認ください → <a href="https://example.com" target="_blank">Example</a>`
    },
    {
      category: "学校",
      category2: "連絡先",
      subject: "学校情報",
      body: `学校の公式サイト: <a href="https://school.example.jp" target="_blank">school.example.jp</a>`
    },
    {
      category: "事業",
      category2: "公式ページ",
      subject: "会社案内",
      body: `事業内容の詳細は <a href="https://business.example.jp" target="_blank">こちら</a> を参照`
    }
  ];

  const modalOverlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");

  function showModal(title, body) {
    modalTitle.textContent = title;
    modalBody.innerHTML = body; // ← ハイパーリンク有効
    modalOverlay.style.display = "flex";
  }

  function closeModal() {
    modalOverlay.style.display = "none";
  }

  modalOverlay.addEventListener("click", function(e) {
    if(e.target === modalOverlay) closeModal();
  });

  function performSearch() {
    const cat = document.getElementById("categorySelect").value.trim();
    const keyword = document.getElementById("keyword").value.trim();
    const mode = document.getElementById("mode").value;
    const resultsTbody = document.getElementById("results");
    resultsTbody.innerHTML = "";

    let keywords = keyword ? keyword.split(/\s+/) : [];

    const filtered = excelData.filter(item => {
      if (cat && item.category.trim() !== cat) return false;
      if (keywords.length === 0) return true;
      const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
      if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
      else return keywords.some(k => text.includes(k.toLowerCase()));
    });

    if (filtered.length === 0) {
      const row = document.createElement("tr");
      const cell = document.createElement("td");
      cell.colSpan = 2;
      cell.textContent = "該当なし";
      row.appendChild(cell);
      resultsTbody.appendChild(row);
      return;
    }

    filtered.forEach(item => {
      const row = document.createElement("tr");
      const td1 = document.createElement("td");
      td1.textContent = item.category;
      const td2 = document.createElement("td");
      td2.textContent = item.category2;
      row.appendChild(td1);
      row.appendChild(td2);
      row.addEventListener("click", () => {
        showModal(item.subject, item.body);
      });
      resultsTbody.appendChild(row);
    });
  }

  // カテゴリ一覧を生成
  const categories = new Set(excelData.map(item => item.category));
  const select = document.getElementById("categorySelect");
  categories.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });

  document.getElementById("keyword").addEventListener("input", performSearch);
  document.getElementById("categorySelect").addEventListener("change", performSearch);
  document.getElementById("mode").addEventListener("change", performSearch);

  performSearch();
});
</script>

</body>
</html>