<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }
h2, h3, h4 { margin: 10px 0; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }
#container { display: flex; flex-wrap: wrap; gap: 20px; }
#results, #history { flex: 1; min-width: 300px; }
.result-item { cursor: pointer; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
.result-item:hover { background-color: #f0f0f0; }

#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>試作品</h2>

<label>カテゴリー：</label>
<select id="categorySelect">
<option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
<option value="AND">AND検索</option>
<option value="OR">OR検索</option>
</select>

<div id="container">
  <div>
    <h3>検索結果</h3>
    <div id="results"></div>
  </div>
  <div id="history">
    <h3>更新履歴</h3>
    <p>［Ver］1.0｜［更新内容］新規作成｜［更新者］菅原｜［承認者］｜［更新日］2025/08/29</p>
    <p>［Ver］1.1｜［更新内容］リンク対応｜［更新者］菅原｜［承認者］｜［更新日］2025/09/01</p>
  </div>
</div>

<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const excelData = [
    {category: "メモ", category2: "URL／アカウント", subject:"参考サイト", body: `
こちらは参考用のリンクです。
<a href="https://www.google.com" target="_blank">Google</a> を開きます。
`},
    {category: "世帯(個人)", category2: "生活", subject:"家計メモ", body: `
電気代の支払い期日を確認。
<a href="https://www.tepco.co.jp" target="_blank">東京電力</a> のサイトで詳細確認。
`},
    {category: "事業", category2: "公式サイト", subject:"業務連絡", body: `
業務管理は公式ポータルから。
<a href="https://www.example.com" target="_blank">ポータルサイト</a> を利用してください。
`}
  ];

  const modalOverlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");

  function showModal(title, body) {
    modalTitle.textContent = title;
    modalBody.innerHTML = body; // ←リンクを有効化
    modalOverlay.style.display = "flex";
  }

  function closeModal() {
    modalOverlay.style.display = "none";
  }

  modalOverlay.addEventListener("click", function(e) {
    if(e.target === modalOverlay) closeModal();
  });

  function performSearch() {
    const cat = document.getElementById("categorySelect").value.trim();
    const keyword = document.getElementById("keyword").value.trim();
    const mode = document.getElementById("mode").value;
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    let keywords = keyword ? keyword.split(/\s+/) : [];

    const filtered = excelData.filter(item => {
      if (cat && item.category.trim() !== cat) return false;
      if (keywords.length === 0) return true;
      const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
      if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
      else return keywords.some(k => text.includes(k.toLowerCase()));
    });

    if (filtered.length === 0) {
      resultsDiv.textContent = "該当なし";
      return;
    }

    filtered.forEach(item => {
      const div = document.createElement("div");
      div.className = "result-item";
      div.textContent = `［カテゴリー：${item.category}］｜［詳細：${item.category2}］`;
      div.addEventListener("click", () => {
        showModal(item.subject, item.body);
      });
      resultsDiv.appendChild(div);
    });
  }

  const categories = new Set(excelData.map(item => item.category));
  const select = document.getElementById("categorySelect");
  categories.forEach(c => {
    if(c){
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      select.appendChild(opt);
    }
  });

  document.getElementById("keyword").addEventListener("input", performSearch);
  document.getElementById("categorySelect").addEventListener("change", performSearch);
  document.getElementById("mode").addEventListener("change", performSearch);

  performSearch();
});
</script>

</body>
</html>