<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>検索ビューア</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
  /* サイドメニュー */
  .sidebar { width: 250px; background: #f5f5f5; overflow-y: auto; border-right: 1px solid #ccc; }
  .sidebar-header { background: #666; color: white; text-align: center; padding: 10px; }
  .sidebar-header h2, .sidebar-header p { margin: 5px 0; }
  .accordion { border-top: 1px solid #ccc; }
  .accordion button { width: 100%; text-align: left; padding: 10px; border: none; background: #eee; cursor: pointer; }
  .accordion button.active, .accordion button:hover { background: #ddd; }
  .panel { display: none; padding: 10px; background: #fafafa; border-top: 1px solid #ccc; }
  /* メイン */
  .main { flex: 1; display: flex; flex-direction: column; }
  .search-bar { padding: 10px; border-bottom: 1px solid #ccc; display: flex; flex-wrap: wrap; align-items: center; }
  .search-bar label { margin-left: 10px; }
  .search-bar select, .search-bar input { margin: 5px; padding: 5px; }
  .results { flex: 1; overflow-y: auto; padding: 10px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  tr:hover { background: #f0f0f0; cursor: pointer; }
  /* フッター */
  .footer { border-top: 1px solid #ccc; }
  .footer .accordion button { background: #eee; }
  /* モーダル */
  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
  .modal-content { background: white; padding: 20px; max-width: 600px; max-height: 80%; overflow-y: auto; white-space: pre-wrap; }
  .close { float: right; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>
  <!-- サイドメニュー -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>サイドメニュー</h2>
      <p id="today"></p>
    </div>
    <div class="accordion">
      <button>メニュー1</button>
      <div class="panel">メニュー1の内容</div>
      <button>メニュー2</button>
      <div class="panel">メニュー2の内容</div>
    </div>
  </div>

  <!-- メイン -->
  <div class="main">
    <div class="search-bar">
      <label for="category">カテゴリ:</label>
      <select id="category"><option value="">すべて</option></select>

      <label for="searchMode">検索方法:</label>
      <select id="searchMode">
        <option value="and">AND検索</option>
        <option value="or">OR検索</option>
      </select>

      <label for="keyword">検索:</label>
      <input type="text" id="keyword" placeholder="件名・本文で検索">
    </div>
    <div class="results">
      <table id="resultsTable">
        <thead><tr><th>カテゴリ</th><th>件名</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="footer">
      <div class="accordion">
        <button>更新履歴</button>
        <div class="panel">
          <table>
            <thead><tr><th>更新内容</th><th>更新者</th><th>承認者</th><th>更新日</th></tr></thead>
            <tbody>
              <tr><td>AND/OR検索追加</td><td>田中</td><td>佐藤</td><td>2025/09/09</td></tr>
              <tr><td>自動検索実装</td><td>鈴木</td><td>高橋</td><td>2025/09/09</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- モーダル -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

<script>
  // 今日の日付
  const days = ["日","月","火","水","木","金","土"];
  const now = new Date();
  document.getElementById("today").textContent =
    now.getFullYear() + "/" + String(now.getMonth()+1).padStart(2,"0") + "/" +
    String(now.getDate()).padStart(2,"0") + "(" + days[now.getDay()] + ")";

  // 検索データ
  const searchData = [
    {category:"お知らせ", subject:"システム更新", body:`システムを更新しました。
詳細は以下の通りです。
1. 検索機能追加
2. モーダル表示改善
3. UI調整
...（以下長文でも可、改行そのまま表示されます）`},
    {category:"障害情報", subject:"ネットワーク障害", body:"現在、一部ネットワークに障害が発生しています。"},
    {category:"メンテナンス", subject:"定期メンテナンス", body:"次回メンテナンスは2025/09/15に実施予定です。"}
  ];

  // カテゴリ自動生成
  const categorySet = [...new Set(searchData.map(d => d.category))];
  const categorySelect = document.getElementById("category");
  categorySet.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    categorySelect.appendChild(opt);
  });

  // 検索処理
  function search() {
    const category = categorySelect.value;
    const keyword = document.getElementById("keyword").value.trim();
    const mode = document.getElementById("searchMode").value;
    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    // 複数ワードを分割
    const words = keyword ? keyword.split(/\s+/) : [];

    searchData.forEach(item => {
      let match = true;

      if (category && item.category !== category) {
        match = false;
      }

      if (words.length > 0) {
        const target = item.subject + " " + item.body;
        if (mode === "and") {
          // 全てのキーワードを含む
          match = match && words.every(w => target.includes(w));
        } else {
          // どれか1つを含む
          match = match && words.some(w => target.includes(w));
        }
      }

      if (match) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${item.category}</td><td>${item.subject}</td>`;
        tr.onclick = () => openModal(item.body);
        tbody.appendChild(tr);
      }
    });
  }

  // モーダル
  function openModal(text) {
    document.getElementById("modalBody").textContent = text;
    document.getElementById("modal").style.display = "flex";
  }
  function closeModal() {
    document.getElementById("modal").style.display = "none";
  }

  // アコーディオン
  document.querySelectorAll(".accordion button").forEach(btn=>{
    btn.addEventListener("click", function(){
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      panel.style.display = panel.style.display==="block" ? "none" : "block";
    });
  });

  // 自動検索イベント
  document.getElementById("keyword").addEventListener("input", search);
  document.getElementById("category").addEventListener("change", search);
  document.getElementById("searchMode").addEventListener("change", search);

  // 初期表示
  search();
</script>
</body>
</html>