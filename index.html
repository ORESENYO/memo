<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }
h2, h3,h4 { margin: 10px 0; cursor: pointer; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }

/* 共通テーブル */
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
th { background: #f8f8f8; }

/* 検索結果用 */
#resultsTable tbody tr:nth-child(odd) { background-color: #ffffff; }
#resultsTable tbody tr:nth-child(even) { background-color: #f9f9f9; }
#resultsTable tbody tr:hover { background-color: #e0e0ff; cursor: pointer; }

/* 更新履歴用 */
#historyTable tbody tr:nth-child(odd) { background-color: #ffffff; }
#historyTable tbody tr:nth-child(even) { background-color: #e6f2ff; } /* 薄青 */
#historyTable tbody tr:hover { background-color: #cce0ff; }

/* モーダル */
#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>試作品</h2>

<label>カテゴリー：</label>
<select id="categorySelect">
  <option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
  <option value="AND">AND検索</option>
  <option value="OR">OR検索</option>
</select>

<h3>検索結果</h3>
<div id="results"></div>

<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
  </div>
</div>

<!-- 更新履歴 -->
<h4 id="toggleHistory">＃更新履歴（クリックで表示/非表示）</h4>
<div id="historyTable">
  <table>
    <thead>
      <tr>
        <th>Ver</th>
        <th>更新内容</th>
        <th>更新者</th>
        <th>承認者</th>
        <th>更新日</th>
      </tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

const excelData = [
  {category: "メモ", category2: "URL／アカウント", subject: "参考リンク",
   body: `公式サイトはこちら → <a href="https://example.com" target="_blank">https://example.com</a>`},
  {category: "世帯(個人)", category2: "生活関連", subject: "備忘録",
   body: `ここには個人関連のメモが入ります。`},
  {category: "事業", category2: "経営", subject: "事業計画",
   body: `事業計画の初期草案。`},
  {category: "学校", category2: "教育", subject: "学習メモ",
   body: `授業の内容メモ。`}
];

const updateHistory = [
  {ver:"1.0", content:"新規作成", author:"菅原", approver:"", date:"2025/08/29"},
  {ver:"1.1", content:"リンク追加", author:"菅原", approver:"上長A", date:"2025/09/01"}
];

const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

function showModal(title, body) {
  modalTitle.textContent = title;
  modalBody.innerHTML = body;
  modalOverlay.style.display = "flex";
}
function closeModal() { modalOverlay.style.display = "none"; }
modalOverlay.addEventListener("click", e => { if(e.target === modalOverlay) closeModal(); });

function performSearch() {
  const cat = document.getElementById("categorySelect").value.trim();
  const keyword = document.getElementById("keyword").value.trim();
  const mode = document.getElementById("mode").value;
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";

  let keywords = keyword ? keyword.split(/\s+/) : [];

  const filtered = excelData.filter(item => {
    if (cat && item.category.trim() !== cat) return false;
    if (keywords.length === 0) return true;
    const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
    if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
    else return keywords.some(k => text.includes(k.toLowerCase()));
  });

  if (filtered.length === 0) {
    resultsDiv.textContent = "該当なし";
    return;
  }

  const table = document.createElement("table");
  table.innerHTML = `<thead><tr><th>カテゴリー</th><th>詳細</th><th>件名</th></tr></thead>`;
  const tbody = document.createElement("tbody");

  filtered.forEach(item => {
    const row = document.createElement("tr");
    row.className = "result-row";
    row.innerHTML = `<td>${item.category}</td><td>${item.category2}</td><td>${item.subject}</td>`;
    row.addEventListener("click", () => { showModal(item.subject, item.body); });
    tbody.appendChild(row);
  });
  table.appendChild(tbody);
  resultsDiv.appendChild(table);
}

// カテゴリー選択肢生成
const categories = new Set(excelData.map(item => item.category));
const select = document.getElementById("categorySelect");
categories.forEach(c => {
  if(c.trim()){ const opt = document.createElement("option"); opt.value = c; opt.textContent = c; select.appendChild(opt); }
});

// 更新履歴テーブル生成
const historyBody = document.getElementById("historyBody");
updateHistory.forEach(h => {
  const row = document.createElement("tr");
  row.innerHTML = `<td>${h.ver}</td><td>${h.content}</td><td>${h.author}</td><td>${h.approver}</td><td>${h.date}</td>`;
  historyBody.appendChild(row);
});

// 更新履歴トグル
document.getElementById("toggleHistory").addEventListener("click", () => {
  const tbl = document.getElementById("historyTable");
  tbl.style.display = (tbl.style.display === "none" || tbl.style.display === "") ? "block" : "none";
});

// イベント
document.getElementById("keyword").addEventListener("input", performSearch);
document.getElementById("categorySelect").addEventListener("change", performSearch);
document.getElementById("mode").addEventListener("change", performSearch);

// 初期表示
performSearch();
});
</script>

</body>
</html>