<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0;
}

/* ヘッダー */
header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #444;
  color: white;
  height: 90px;
  position: relative;
}
header h1 {
  margin: 0;
  font-size: 1.5em;
}
header .date {
  font-size: 1em;
  margin-top: 5px;
}
.menu-toggle {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.5em;
  background: rgba(0,0,0,0.7);
  color: white;
  border: none;
  cursor: pointer;
  padding: 5px 10px;
  border-radius: 4px;
}

/* サイドメニュー */
#sideMenu {
  position: fixed;
  top: 0;
  left: -260px;
  width: 260px;
  height: 100%;
  background: #f4f4f4;
  box-shadow: 2px 0 5px rgba(0,0,0,0.3);
  transition: left 0.3s ease;
  display: flex;
  flex-direction: column;
}
#sideMenu.open {
  left: 0;
}
#sideMenu header {
  background: #444;
  color: white;
  height: 90px;
  display: flex;
  align-items: center;
  padding: 0 15px;
  box-sizing: border-box;
}
#sideMenu .menu-toggle {
  margin-right: 10px;
}

/* サイドメニュー アコーディオン */
.accordion {
  width: 100%;
  border-top: 1px solid #ccc;
}
.accordion-item {
  border-bottom: 1px solid #ccc;
}
.accordion-header {
  padding: 10px;
  cursor: pointer;
  background: #eee;
}
.accordion-content {
  display: none;
  padding: 10px;
}
.accordion-content.open {
  display: block;
}

/* メインコンテンツ */
.container {
  padding: 20px;
}
input, select {
  margin: 5px;
  padding: 5px;
  font-size: 1em;
}

/* テーブル */
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 15px;
}
table, th, td {
  border: 1px solid #ccc;
}
th, td {
  padding: 8px;
  text-align: left;
}

/* モーダル */
#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }

/* 更新履歴アコーディオン */
#historyAccordion {
  margin-top: 20px;
}
#historyAccordion .accordion-header {
  background: #ddd;
  font-weight: bold;
}
</style>
</head>
<body>

<!-- メインヘッダー -->
<header>
  <button id="menuToggle" class="menu-toggle">≡</button>
  <h1>試作品</h1>
  <div class="date" id="currentDate"></div>
</header>

<!-- サイドメニュー -->
<div id="sideMenu">
  <header>
    <button id="menuToggleSide" class="menu-toggle">×</button>
    <h1>メニュー</h1>
  </header>
  <div class="accordion">
    <div class="accordion-item">
      <div class="accordion-header">見出し1</div>
      <div class="accordion-content">
        <p>コンテンツ名A</p>
        <p>コンテンツ名B</p>
      </div>
    </div>
    <div class="accordion-item">
      <div class="accordion-header">見出し2</div>
      <div class="accordion-content">
        <p>コンテンツ名C</p>
        <p>コンテンツ名D</p>
      </div>
    </div>
  </div>
</div>

<!-- メインコンテンツ -->
<div class="container">
  <h3>検索</h3>
  <label>カテゴリー：</label>
  <select id="categorySelect"><option value="">すべて</option></select>
  <label>検索：</label>
  <input type="text" id="keyword" placeholder="キーワードを入力">
  <select id="mode">
    <option value="AND">AND検索</option>
    <option value="OR">OR検索</option>
  </select>

  <h3>検索結果</h3>
  <table id="results">
    <thead><tr><th>カテゴリー</th><th>詳細</th></tr></thead>
    <tbody></tbody>
  </table>

  <!-- 更新履歴をアコーディオンで -->
  <div id="historyAccordion" class="accordion">
    <div class="accordion-item">
      <div class="accordion-header">更新履歴</div>
      <div class="accordion-content">
        <table>
          <thead><tr><th>Ver</th><th>更新内容</th><th>更新者</th><th>承認者</th><th>更新日</th></tr></thead>
          <tbody>
            <tr><td>1.0</td><td>新規作成</td><td>菅原</td><td>-</td><td>2025/08/29</td></tr>
            <tr><td>1.1</td><td>検索機能改善</td><td>菅原</td><td>-</td><td>2025/09/05</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- モーダル -->
<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // 日付表示 yyyy/mm/dd(aaa)
  const week = ["日","月","火","水","木","金","土"];
  const today = new Date();
  const formatted = today.getFullYear() + "/" +
    String(today.getMonth()+1).padStart(2,"0") + "/" +
    String(today.getDate()).padStart(2,"0") +
    "(" + week[today.getDay()] + ")";
  document.getElementById("currentDate").textContent = formatted;

  // サイドメニュー開閉
  const sideMenu = document.getElementById("sideMenu");
  document.getElementById("menuToggle").addEventListener("click", () => {
    sideMenu.classList.toggle("open");
  });
  document.getElementById("menuToggleSide").addEventListener("click", () => {
    sideMenu.classList.toggle("open");
  });

  // アコーディオン共通処理
  document.querySelectorAll(".accordion-header").forEach(header => {
    header.addEventListener("click", () => {
      const content = header.nextElementSibling;
      content.classList.toggle("open");
    });
  });

  // データ
  const excelData = [
    {category: "メモ", category2: "URL／アカウント", body: `こちらは<a href="https://example.com" class="copyLink" data-copy="あああ">リンク①</a>です。\n利用してください。\n参考にどうぞ。`},
    {category: "世帯(個人)", category2: "連絡先", body: `テスト用の<a href="https://example.org" class="copyLink" data-copy="111">リンク②</a>です。\n詳細をご確認ください。\nよろしくお願いします。`}
  ];

  const resultsTbody = document.querySelector("#results tbody");
  const modalOverlay = document.getElementById("modalOverlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");

  function showModal(title, body) {
    modalTitle.textContent = title;
    modalBody.innerHTML = body;
    modalOverlay.style.display = "flex";
  }
  modalOverlay.addEventListener("click", e => {
    if (e.target === modalOverlay) modalOverlay.style.display = "none";
  });

  function performSearch() {
    const cat = document.getElementById("categorySelect").value.trim();
    const keyword = document.getElementById("keyword").value.trim();
    const mode = document.getElementById("mode").value;
    resultsTbody.innerHTML = "";

    let keywords = keyword ? keyword.split(/\s+/) : [];
    const filtered = excelData.filter(item => {
      if (cat && item.category.trim() !== cat) return false;
      if (!keywords.length) return true;
      const text = (item.category2 + " " + item.body).toLowerCase();
      if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
      else return keywords.some(k => text.includes(k.toLowerCase()));
    });

    if (filtered.length === 0) {
      resultsTbody.innerHTML = `<tr><td colspan="2">該当なし</td></tr>`;
      return;
    }

    filtered.forEach(item => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${item.category}</td><td>${item.category2}</td>`;
      tr.addEventListener("click", () => showModal(item.category, item.body));
      resultsTbody.appendChild(tr);
    });
  }

  // カテゴリー選択肢生成
  const categories = new Set(excelData.map(item => item.category));
  const select = document.getElementById("categorySelect");
  categories.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });

  document.getElementById("keyword").addEventListener("input", performSearch);
  document.getElementById("categorySelect").addEventListener("change", performSearch);
  document.getElementById("mode").addEventListener("change", performSearch);

  performSearch();

  // コピー付きリンク処理
  document.addEventListener("click", function(e) {
    if (e.target.classList.contains("copyLink")) {
      e.preventDefault();
      const textToCopy = e.target.getAttribute("data-copy");
      navigator.clipboard.writeText(textToCopy);
      window.open(e.target.href, "_blank");
    }
  });
});
</script>
</body>
</html>