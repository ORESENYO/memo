<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>コンテンツ検索</title>
<style>
  body { font-family: sans-serif; margin: 20px; background: #f9f9f9; }
  h2 { color: #333; }

  /* 検索フォーム */
  select, input, button { margin: 5px; padding: 6px; font-size: 14px; }

  /* 検索結果 */
  #results div {
    background: #fff;
    border: 1px solid #ddd;
    margin: 6px 0;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
  }
  #results div:hover { background: #f0f8ff; }
  .subject { font-weight: bold; color: #0066cc; font-size: 16px; }
  .category { font-size: 12px; color: #555; margin-top: 4px; }

  /* モーダル */
  .modal {
    display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6); z-index: 1000;
  }
  .modal-content {
    background: #fff; width: 90%; max-width: 600px; margin: 60px auto;
    padding: 20px; border-radius: 8px; max-height: 70vh; overflow-y: auto;
  }
  .modal h3 { margin-top: 0; color: #0066cc; }
</style>
</head>
<body>

<h2>コンテンツ検索</h2>
<label>カテゴリー: 
  <select id="categorySelect">
    <option value="">すべて</option>
  </select>
</label>
<label>キーワード: <input type="text" id="keyword"></label>
<select id="searchType">
  <option value="AND">AND</option>
  <option value="OR">OR</option>
</select>
<button onclick="performSearch()">検索</button>

<div id="results"></div>

<!-- モーダル -->
<div id="modal" class="modal" onclick="closeModal(event)">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
let excelData = [
  {
    category: "ニュース",
    category2: "国内",
    subject: "政治に関する最新情報",
    body: `本文サンプル1 行1
本文サンプル1 行2
本文サンプル1 行3
本文サンプル1 行4
本文サンプル1 行5`
  },
  {
    category: "スポーツ",
    category2: "海外",
    subject: "サッカー大会の結果",
    body: `本文サンプル2 行1
本文サンプル2 行2
本文サンプル2 行3
本文サンプル2 行4
本文サンプル2 行5`
  },
  {
    category: "テクノロジー",
    category2: "AI",
    subject: "新しいAI技術の発表",
    body: `本文サンプル3 行1
本文サンプル3 行2
本文サンプル3 行3
本文サンプル3 行4
本文サンプル3 行5`
  }
];

// カテゴリー選択肢を生成
function populateCategories() {
  const select = document.getElementById("categorySelect");
  let cats = [...new Set(excelData.map(d => d.category))];
  cats.forEach(c => {
    let opt = document.createElement("option");
    opt.value = c; opt.textContent = c;
    select.appendChild(opt);
  });
}

// 検索処理
function performSearch() {
  const category = document.getElementById("categorySelect").value;
  const keyword = document.getElementById("keyword").value.trim().toLowerCase();
  const type = document.getElementById("searchType").value;
  const results = document.getElementById("results");
  results.innerHTML = "";

  excelData.forEach((row, idx) => {
    if (category && row.category !== category) return;
    let text = [row.category2, row.subject, row.body].join(" ").toLowerCase();
    let match = true;
    if (keyword) {
      let keys = keyword.split(/\s+/);
      match = (type === "AND") ?
        keys.every(k => text.includes(k)) :
        keys.some(k => text.includes(k));
    }
    if (match) {
      const div = document.createElement("div");
      div.innerHTML = `<div class="subject">${row.subject}</div>
                       <div class="category">[${row.category}] [${row.category2}]</div>`;
      div.onclick = () => openModal(row);
      results.appendChild(div);
    }
  });
}

// モーダル表示
function openModal(row) {
  const modal = document.getElementById("modal");
  const content = document.getElementById("modalContent");
  content.innerHTML = `<h3>${row.subject}</h3><pre>${row.body}</pre>`;
  modal.style.display = "block";
}

// モーダルを閉じる
function closeModal(e) {
  if (e.target.id === "modal") {
    document.getElementById("modal").style.display = "none";
  }
}

// 初期化
populateCategories();
performSearch();
</script>
</body>
</html>