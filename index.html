<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>試作品</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; margin: 0; padding: 20px; }

/* タイトル */
h2.title { text-align: center; margin: 10px 0 5px 0; }
#today { text-align: center; font-size: 0.9em; color: #555; margin-bottom: 20px; }

/* ハンバーガーメニュー */
#hamburger {
  position: fixed; top: 15px; right: 20px;
  font-size: 28px; cursor: pointer; z-index: 1001;
}

/* サイドメニュー */
#sideMenu {
  position: fixed; top: 0; right: -250px;
  width: 250px; height: 100%;
  background: #fff; box-shadow: -2px 0 5px rgba(0,0,0,0.3);
  transition: right 0.3s ease; z-index: 1000;
  padding: 20px; overflow-y: auto;
}
#sideMenu.open { right: 0; }
.accordion { border-bottom: 1px solid #ccc; }
.accordion h4 {
  margin: 0; padding: 10px; cursor: pointer;
  background: #f0f0f0;
}
.accordion-content {
  display: none; padding: 5px 15px;
}
.accordion-content a {
  display: block; padding: 5px 0; text-decoration: none; color: #333;
}
.accordion-content a:hover { text-decoration: underline; }

/* 検索部分 */
h3,h4 { margin: 10px 0; cursor: pointer; }
input, select { margin: 5px; padding: 5px; font-size: 1em; }

/* テーブル共通 */
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
th { background: #f8f8f8; }

/* 検索結果の項目クリック */
.result-row { cursor: pointer; }
.result-row:hover { background-color: #f0f0f0; }

/* モーダル */
#modalOverlay {
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); z-index: 999;
  justify-content: center; align-items: center;
}
#modalContent {
  background: white; padding: 20px; border-radius: 8px;
  max-width: 90%; max-height: 80%; overflow-y: auto;
  box-sizing: border-box;
}
#modalContent h3 { margin-top: 0; word-break: break-word; }
#modalContent p { white-space: pre-wrap; word-break: break-word; }

/* 更新履歴 */
#historyTable { display: none; margin-top: 10px; }
</style>
</head>
<body>

<!-- タイトル -->
<h2 class="title">試作品</h2>
<div id="today"></div>

<!-- ハンバーガーメニュー -->
<div id="hamburger">≡</div>
<div id="sideMenu">
  <div class="accordion">
    <h4>グループ1</h4>
    <div class="accordion-content">
      <a href="#">コンテンツ1</a>
      <a href="#">コンテンツ2</a>
    </div>
  </div>
  <div class="accordion">
    <h4>グループ2</h4>
    <div class="accordion-content">
      <a href="#">コンテンツ3</a>
      <a href="#">コンテンツ4</a>
    </div>
  </div>
</div>

<!-- 検索 -->
<label>カテゴリー：</label>
<select id="categorySelect">
  <option value="">すべて</option>
</select>

<label>検索：</label>
<input type="text" id="keyword" placeholder="キーワードを入力">
<select id="mode">
  <option value="AND">AND検索</option>
  <option value="OR">OR検索</option>
</select>

<h3>検索結果</h3>
<div id="results"></div>

<!-- モーダル -->
<div id="modalOverlay">
  <div id="modalContent">
    <h3 id="modalTitle"></h3>
    <p id="modalBody"></p>
  </div>
</div>

<h4 id="toggleHistory">＃更新履歴（クリックで表示/非表示）</h4>
<div id="historyTable">
  <table>
    <thead>
      <tr>
        <th>Ver</th>
        <th>更新内容</th>
        <th>更新者</th>
        <th>承認者</th>
        <th>更新日</th>
      </tr>
    </thead>
    <tbody id="historyBody"></tbody>
  </table>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

// 今日の日付を yyyy/mm/dd(aaa) 形式で表示
const todayEl = document.getElementById("today");
const now = new Date();
const week = ["日","月","火","水","木","金","土"];
const todayStr = `${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,"0")}/${String(now.getDate()).padStart(2,"0")}(${week[now.getDay()]})`;
todayEl.textContent = todayStr;

// データ定義（リンク入りサンプル）
const excelData = [
  {
    category: "メモ",
    category2: "URL／アカウント",
    subject: "参考リンク",
    body: `<a href="https://example.com" class="copyLink" data-copy="あああ">①</a><br>
           <a href="https://example.com" class="copyLink" data-copy="111">②</a>`
  },
  {
    category: "世帯(個人)",
    category2: "生活関連",
    subject: "備忘録",
    body: `個人関連のメモです。`
  },
  {
    category: "事業",
    category2: "経営",
    subject: "事業計画",
    body: `事業計画の初期草案はこちら。`
  },
];

// 更新履歴
const updateHistory = [
  {ver:"1.0", content:"新規作成", author:"菅原", approver:"", date:"2025/08/29"},
  {ver:"1.1", content:"リンク追加", author:"菅原", approver:"上長A", date:"2025/09/01"}
];

// モーダル処理
const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

function showModal(title, body) {
  modalTitle.textContent = title;
  modalBody.innerHTML = body; // HTML描画 → リンク有効
  modalOverlay.style.display = "flex";
}
function closeModal() { modalOverlay.style.display = "none"; }
modalOverlay.addEventListener("click", e => { if(e.target === modalOverlay) closeModal(); });

// 検索処理
function performSearch() {
  const cat = document.getElementById("categorySelect").value.trim();
  const keyword = document.getElementById("keyword").value.trim();
  const mode = document.getElementById("mode").value;
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";

  let keywords = keyword ? keyword.split(/\s+/) : [];

  const filtered = excelData.filter(item => {
    if (cat && item.category.trim() !== cat) return false;
    if (!keywords.length) return true;
    const text = (item.category2 + " " + item.subject + " " + item.body).toLowerCase();
    if (mode === "AND") return keywords.every(k => text.includes(k.toLowerCase()));
    else return keywords.some(k => text.includes(k.toLowerCase()));
  });

  if (!filtered.length) { resultsDiv.textContent = "該当なし"; return; }

  const table = document.createElement("table");
  table.innerHTML = `<thead><tr><th>カテゴリー</th><th>詳細</th><th>件名</th></tr></thead>`;
  const tbody = document.createElement("tbody");

  filtered.forEach(item => {
    const row = document.createElement("tr");
    row.className = "result-row";
    row.innerHTML = `<td>${item.category}</td><td>${item.category2}</td><td>${item.subject}</td>`;
    row.addEventListener("click", () => { showModal(item.subject, item.body); });
    tbody.appendChild(row);
  });
  table.appendChild(tbody);
  resultsDiv.appendChild(table);
}

// カテゴリ生成
const categories = new Set(excelData.map(item => item.category));
const select = document.getElementById("categorySelect");
categories.forEach(c => {
  if(c.trim()) { const opt=document.createElement("option"); opt.value=c; opt.textContent=c; select.appendChild(opt); }
});

// 更新履歴生成
const historyBody = document.getElementById("historyBody");
updateHistory.forEach(h => {
  const row = document.createElement("tr");
  row.innerHTML = `<td>${h.ver}</td><td>${h.content}</td><td>${h.author}</td><td>${h.approver}</td><td>${h.date}</td>`;
  historyBody.appendChild(row);
});

// 更新履歴トグル
document.getElementById("toggleHistory").addEventListener("click", () => {
  const tbl = document.getElementById("historyTable");
  tbl.style.display = (tbl.style.display==="none"||tbl.style.display==="") ? "block" : "none";
});

// モーダル内リンククリック処理（コピー＋遷移）
document.addEventListener("click", async function(e){
  const link = e.target.closest("a.copyLink");
  if(link){
    e.preventDefault();
    const textToCopy = link.dataset.copy || "";
    try { await navigator.clipboard.writeText(textToCopy); } 
    catch(err){ console.error("コピー失敗", err); }
    window.open(link.href,"_blank");
  }
});

// ハンバーガーメニュー開閉
const hamburger = document.getElementById("hamburger");
const sideMenu = document.getElementById("sideMenu");
hamburger.addEventListener("click", ()=> {
  sideMenu.classList.toggle("open");
});

// アコーディオン処理
document.querySelectorAll(".accordion h4").forEach(header=>{
  header.addEventListener("click", ()=>{
    const content = header.nextElementSibling;
    content.style.display = (content.style.display==="block") ? "none" : "block";
  });
});

// 初期表示
performSearch();

});
</script>

</body>
</html>